<!DOCTYPE html>
<html><head><title>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matRad_calcDoseFillDij.m</title><STYLE TYPE="text/css"><!--TD{font-family: "Courier New", Courier, monospace; font-size: 10pt;}---></STYLE></head><body><p>(Back to <a href="index.html">index</a>)</p><h1>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matRad_calcDoseFillDij.m</h1><p style="font-family:'Courier New'"><table>
<tr><th>Line</th><th>Code</th></tr>
<tr><td>1</td><td bgcolor="#FFFFFF">%&nbsp;save&nbsp;computation&nbsp;time&nbsp;and&nbsp;memory&nbsp;</td></tr>
<tr><td>2</td><td bgcolor="#FFFFFF">%&nbsp;by&nbsp;sequentially&nbsp;filling&nbsp;the&nbsp;sparse&nbsp;matrix&nbsp;dose.dij&nbsp;from&nbsp;the&nbsp;cell&nbsp;array</td></tr>
<tr><td>3</td><td bgcolor="#FF0000">if&nbsp;mod(counter,numOfBixelsContainer)&nbsp;==&nbsp;0&nbsp;||&nbsp;counter&nbsp;==&nbsp;dij.totalNumOfBixels</td></tr>
<tr><td>4</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>5</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;calcDoseDirect</td></tr>
<tr><td>6</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isfield(stf(1).ray(1),'weight')&nbsp;&amp;&amp;&nbsp;numel(stf(i).ray(j).weight)&nbsp;&gt;=&nbsp;k</td></tr>
<tr><td>7</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>8</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;score&nbsp;physical&nbsp;dose</td></tr>
<tr><td>9</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.physicalDose{1}(:,i)&nbsp;=&nbsp;dij.physicalDose{1}(:,i)&nbsp;+&nbsp;stf(i).ray(j).weight(k)&nbsp;*&nbsp;doseTmpContainer{1,1};</td></tr>
<tr><td>10</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>11</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isfield(dij,'mLETDose')</td></tr>
<tr><td>12</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mLETDose{1}(:,i)&nbsp;=&nbsp;dij.mLETDose{1}(:,i)&nbsp;+&nbsp;stf(i).ray(j).weight(k)&nbsp;*&nbsp;letDoseTmpContainer{1,1};</td></tr>
<tr><td>13</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>14</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>15</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isequal(pln.propOpt.bioOptimization,'LEMIV_effect')&nbsp;||&nbsp;isequal(pln.propOpt.bioOptimization,'LEMIV_RBExD'))&nbsp;...&nbsp;</td></tr>
<tr><td>16</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;strcmp(pln.radiationMode,'carbon')</td></tr>
<tr><td>17</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>18</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;score&nbsp;alpha&nbsp;and&nbsp;beta&nbsp;matrices</td></tr>
<tr><td>19</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mAlphaDose{1}(:,i)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;dij.mAlphaDose{1}(:,i)&nbsp;+&nbsp;stf(i).ray(j).weight(k)&nbsp;*&nbsp;alphaDoseTmpContainer{1,1};</td></tr>
<tr><td>20</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mSqrtBetaDose{1}(:,i)&nbsp;=&nbsp;dij.mSqrtBetaDose{1}(:,i)&nbsp;+&nbsp;stf(i).ray(j).weight(k)&nbsp;*&nbsp;betaDoseTmpContainer{1,1};</td></tr>
<tr><td>21</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>22</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>23</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr>
<tr><td>24</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>25</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(['No&nbsp;weight&nbsp;available&nbsp;for&nbsp;beam&nbsp;'&nbsp;num2str(i)&nbsp;',&nbsp;ray&nbsp;'&nbsp;num2str(j)&nbsp;',&nbsp;bixel&nbsp;'&nbsp;num2str(k)]);</td></tr>
<tr><td>26</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>27</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>28</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr>
<tr><td>29</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>30</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.physicalDose{1}(:,(ceil(counter/numOfBixelsContainer)-1)*numOfBixelsContainer+1:counter)&nbsp;=&nbsp;[doseTmpContainer{1:mod(counter-1,numOfBixelsContainer)+1,1}];</td></tr>
<tr><td>31</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>32</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isfield(dij,'mLETDose')</td></tr>
<tr><td>33</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mLETDose{1}(:,(ceil(counter/numOfBixelsContainer)-1)*numOfBixelsContainer+1:counter)&nbsp;=&nbsp;[letDoseTmpContainer{1:mod(counter-1,numOfBixelsContainer)+1,1}];</td></tr>
<tr><td>34</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>35</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>36</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isequal(pln.propOpt.bioOptimization,'LEMIV_effect')&nbsp;||&nbsp;isequal(pln.propOpt.bioOptimization,'LEMIV_RBExD'))&nbsp;...&nbsp;</td></tr>
<tr><td>37</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;strcmp(pln.radiationMode,'carbon')</td></tr>
<tr><td>38</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>39</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mAlphaDose{1}(:,(ceil(counter/numOfBixelsContainer)-1)*numOfBixelsContainer+1:counter)&nbsp;=&nbsp;[alphaDoseTmpContainer{1:mod(counter-1,numOfBixelsContainer)+1,1}];</td></tr>
<tr><td>40</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dij.mSqrtBetaDose{1}(:,(ceil(counter/numOfBixelsContainer)-1)*numOfBixelsContainer+1:counter)&nbsp;=&nbsp;[betaDoseTmpContainer{1:mod(counter-1,numOfBixelsContainer)+1,1}];</td></tr>
<tr><td>41</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>42</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>43</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>44</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>45</td><td bgcolor="#FFFFFF">end</td></tr>
</table></p></body></html>