<!DOCTYPE html>
<html><head><title>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matlab_unitTests\test_DoseConstraints.m</title><STYLE TYPE="text/css"><!--TD{font-family: "Courier New", Courier, monospace; font-size: 10pt;}---></STYLE></head><body><p>(Back to <a href="index.html">index</a>)</p><h1>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matlab_unitTests\test_DoseConstraints.m</h1><p style="font-family:'Courier New'"><table>
<tr><th>Line</th><th>Code</th></tr>
<tr><td>1</td><td bgcolor="#FFFFFF">function&nbsp;tests&nbsp;=&nbsp;test_DoseConstraints</td></tr>
<tr><td>2</td><td bgcolor="#FF0000">test_functions&nbsp;=&nbsp;{};</td></tr>
<tr><td>3</td><td bgcolor="#FF0000">MyFolderInfo&nbsp;=&nbsp;dir('..\optimization\+DoseConstraints');&nbsp;%relative&nbsp;path</td></tr>
<tr><td>4</td><td bgcolor="#FF0000">for&nbsp;i=1:length(MyFolderInfo)</td></tr>
<tr><td>5</td><td bgcolor="#FF0000">&nbsp;&nbsp;if&nbsp;(MyFolderInfo(i).name(1)~='.')</td></tr>
<tr><td>6</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not(isequal(MyFolderInfo(i).name,&nbsp;'matRad_DoseConstraint.m'))</td></tr>
<tr><td>7</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_functions{end+1}&nbsp;=&nbsp;eval(['@()&nbsp;testComputeDoseConstraintJacobian('''&nbsp;MyFolderInfo(i).name&nbsp;''')']);&nbsp;%Too&nbsp;show&nbsp;which&nbsp;object&nbsp;failed.&nbsp;Too&nbsp;have&nbsp;object&nbsp;name&nbsp;expliceed&nbsp;in&nbsp;function&nbsp;name.</td></tr>
<tr><td>8</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_functions{end+1}&nbsp;=&nbsp;eval(['@()&nbsp;testComputeDoseConstraintFunction('''&nbsp;MyFolderInfo(i).name&nbsp;''')']);&nbsp;%Too&nbsp;show&nbsp;which&nbsp;object&nbsp;failed.&nbsp;Too&nbsp;have&nbsp;object&nbsp;name&nbsp;expliceed&nbsp;in&nbsp;function&nbsp;name.</td></tr>
<tr><td>9</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>10</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;end</td></tr>
<tr><td>11</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>12</td><td bgcolor="#FF0000">test_functions&nbsp;=&nbsp;test_functions';</td></tr>
<tr><td>13</td><td bgcolor="#FF0000">tests&nbsp;=&nbsp;functiontests(test_functions);</td></tr>
<tr><td>14</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>15</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>16</td><td bgcolor="#FFFFFF">function&nbsp;testComputeDoseConstraintJacobian(testCase,&nbsp;fileName)</td></tr>
<tr><td>17</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;concatenationOfFileName&nbsp;=&nbsp;strcat('DoseConstraints.',&nbsp;fileName);</td></tr>
<tr><td>18</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;functionNameHandle&nbsp;=&nbsp;str2func(concatenationOfFileName(1:end-2));</td></tr>
<tr><td>19</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;dose&nbsp;=&nbsp;[10&nbsp;20&nbsp;30&nbsp;40&nbsp;50&nbsp;60]';</td></tr>
<tr><td>20</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;functionNameHandle();&nbsp;%Constructor</td></tr>
<tr><td>21</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;doseConstraintJacobian=obj.computeDoseConstraintJacobian(dose);</td></tr>
<tr><td>22</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;[jac,err]&nbsp;=&nbsp;jacobianest(@(x)&nbsp;obj.computeDoseConstraintFunction(x'),&nbsp;dose');</td></tr>
<tr><td>23</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;epsilon&nbsp;=&nbsp;obj.maxDerivativeError&nbsp;+&nbsp;max(err);</td></tr>
<tr><td>24</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyTrue(testCase,&nbsp;isreal(doseConstraintJacobian));&nbsp;%nth&nbsp;root</td></tr>
<tr><td>25</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%assertVectorsAlmostEqual(jac',&nbsp;doseConstraintJacobian,&nbsp;'relative',&nbsp;epsilon);&nbsp;%&nbsp;Build&nbsp;'assertVectorsAlmostEqual'&nbsp;through&nbsp;subtraction&nbsp;'LessThan'</td></tr>
<tr><td>26</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyEqual(testCase,&nbsp;size(doseConstraintJacobian),&nbsp;size(dose));</td></tr>
<tr><td>27</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;doseConstraintJacobian,&nbsp;NaN);</td></tr>
<tr><td>28</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;doseConstraintJacobian,&nbsp;Inf);</td></tr>
<tr><td>29</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;doseConstraintJacobian,&nbsp;-Inf);</td></tr>
<tr><td>30</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>31</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>32</td><td bgcolor="#FFFFFF">function&nbsp;testComputeDoseConstraintFunction(fileName)</td></tr>
<tr><td>33</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;concatenationOfFileName&nbsp;=&nbsp;strcat('DoseConstraints.',&nbsp;fileName);</td></tr>
<tr><td>34</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;functionNameHandle&nbsp;=&nbsp;str2func(concatenationOfFileName(1:end-2));</td></tr>
<tr><td>35</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;dose&nbsp;=&nbsp;[10&nbsp;20&nbsp;30&nbsp;40&nbsp;50&nbsp;60];</td></tr>
<tr><td>36</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;functionNameHandle();&nbsp;%Constructor</td></tr>
<tr><td>37</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;obj.computeDoseConstraintFunction(dose);</td></tr>
<tr><td>38</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;[r,c]&nbsp;=&nbsp;size(f);</td></tr>
<tr><td>39</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyTrue(testCase,&nbsp;isreal(f));</td></tr>
<tr><td>40</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyGreaterThan(testCase,&nbsp;f,&nbsp;zeros(r,c)&nbsp;-&nbsp;eps);</td></tr>
<tr><td>41</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;f,&nbsp;NaN);</td></tr>
<tr><td>42</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;f,&nbsp;Inf);</td></tr>
<tr><td>43</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;verifyNotEqual(testCase,&nbsp;f,&nbsp;-Inf);</td></tr>
<tr><td>44</td><td bgcolor="#FFFFFF">end</td></tr>
</table></p></body></html>