<!DOCTYPE html>
<html><head><title>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matRad_DijSampling.m</title><STYLE TYPE="text/css"><!--TD{font-family: "Courier New", Courier, monospace; font-size: 10pt;}---></STYLE></head><body><p>(Back to <a href="index.html">index</a>)</p><h1>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\matRad_DijSampling.m</h1><p style="font-family:'Courier New'"><table>
<tr><th>Line</th><th>Code</th></tr>
<tr><td>1</td><td bgcolor="#FFFFFF">function&nbsp;[ixNew,bixelDoseNew]&nbsp;=&nbsp;&nbsp;matRad_DijSampling(ix,bixelDose,radDepthV,rad_distancesSq,sType,Param)</td></tr>
<tr><td>2</td><td bgcolor="#FFFFFF">%&nbsp;matRad&nbsp;dij&nbsp;sampling&nbsp;function&nbsp;</td></tr>
<tr><td>3</td><td bgcolor="#FFFFFF">%&nbsp;This&nbsp;function&nbsp;samples.&nbsp;</td></tr>
<tr><td>4</td><td bgcolor="#FFFFFF">%&nbsp;</td></tr>
<tr><td>5</td><td bgcolor="#FFFFFF">%&nbsp;call</td></tr>
<tr><td>6</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[ixNew,bixelDoseNew]&nbsp;=</td></tr>
<tr><td>7</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;matRad_DijSampling(ix,bixelDose,radDepthV,rad_distancesSq,sType,Param)</td></tr>
<tr><td>8</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>9</td><td bgcolor="#FFFFFF">%&nbsp;input</td></tr>
<tr><td>10</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;ix:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indices&nbsp;of&nbsp;voxels&nbsp;where&nbsp;we&nbsp;want&nbsp;to&nbsp;compute&nbsp;dose&nbsp;influence&nbsp;data</td></tr>
<tr><td>11</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;bixelDose:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dose&nbsp;at&nbsp;specified&nbsp;locations&nbsp;as&nbsp;linear&nbsp;vector</td></tr>
<tr><td>12</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;radDepthV:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radiological&nbsp;depth&nbsp;vector</td></tr>
<tr><td>13</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;rad_distancesSq:&nbsp;&nbsp;squared&nbsp;radial&nbsp;distance&nbsp;to&nbsp;the&nbsp;central&nbsp;ray</td></tr>
<tr><td>14</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;sType:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;either&nbsp;be&nbsp;set&nbsp;to&nbsp;'radius'&nbsp;or&nbsp;'dose'.&nbsp;These&nbsp;are&nbsp;two&nbsp;different&nbsp;ways&nbsp;</td></tr>
<tr><td>15</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;determine&nbsp;dose&nbsp;values&nbsp;that&nbsp;are&nbsp;keept&nbsp;as&nbsp;they&nbsp;are&nbsp;and&nbsp;dose&nbsp;values&nbsp;used&nbsp;for&nbsp;sampling</td></tr>
<tr><td>16</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;Param:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;radius&nbsp;based&nbsp;sampling,&nbsp;dose&nbsp;values&nbsp;having&nbsp;a&nbsp;radial&nbsp;</td></tr>
<tr><td>17</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distance&nbsp;below&nbsp;r0&nbsp;[mm]&nbsp;are&nbsp;keept&nbsp;anyway&nbsp;and&nbsp;sampling&nbsp;is&nbsp;only&nbsp;done&nbsp;beyond&nbsp;r0.&nbsp;</td></tr>
<tr><td>18</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;dose&nbsp;based&nbsp;sampling,&nbsp;dose&nbsp;values&nbsp;having&nbsp;a&nbsp;relative&nbsp;dose&nbsp;greater&nbsp;</td></tr>
<tr><td>19</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;threshold&nbsp;[0...1]&nbsp;are&nbsp;keept&nbsp;and&nbsp;sampling&nbsp;is&nbsp;done&nbsp;for&nbsp;dose&nbsp;values&nbsp;below&nbsp;the&nbsp;relative&nbsp;threshold&nbsp;&nbsp;</td></tr>
<tr><td>20</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>21</td><td bgcolor="#FFFFFF">%&nbsp;output</td></tr>
<tr><td>22</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;ixNew:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reduced&nbsp;indices&nbsp;of&nbsp;voxels&nbsp;where&nbsp;we&nbsp;want&nbsp;to&nbsp;compute&nbsp;dose&nbsp;influence&nbsp;data</td></tr>
<tr><td>23</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;bixelDoseNew&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reduced&nbsp;dose&nbsp;at&nbsp;specified&nbsp;locations&nbsp;as&nbsp;linear&nbsp;vector</td></tr>
<tr><td>24</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>25</td><td bgcolor="#FFFFFF">%&nbsp;References</td></tr>
<tr><td>26</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[1]&nbsp;http://dx.doi.org/10.1118/1.1469633</td></tr>
<tr><td>27</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>28</td><td bgcolor="#FFFFFF">%&nbsp;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</td></tr>
<tr><td>29</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>30</td><td bgcolor="#FFFFFF">%&nbsp;Copyright&nbsp;2016&nbsp;the&nbsp;matRad&nbsp;development&nbsp;team.&nbsp;</td></tr>
<tr><td>31</td><td bgcolor="#FFFFFF">%&nbsp;</td></tr>
<tr><td>32</td><td bgcolor="#FFFFFF">%&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;matRad&nbsp;project.&nbsp;It&nbsp;is&nbsp;subject&nbsp;to&nbsp;the&nbsp;license&nbsp;</td></tr>
<tr><td>33</td><td bgcolor="#FFFFFF">%&nbsp;terms&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;found&nbsp;in&nbsp;the&nbsp;top-level&nbsp;directory&nbsp;of&nbsp;this&nbsp;</td></tr>
<tr><td>34</td><td bgcolor="#FFFFFF">%&nbsp;distribution&nbsp;and&nbsp;at&nbsp;https://github.com/e0404/matRad/LICENSES.txt.&nbsp;No&nbsp;part&nbsp;</td></tr>
<tr><td>35</td><td bgcolor="#FFFFFF">%&nbsp;of&nbsp;the&nbsp;matRad&nbsp;project,&nbsp;including&nbsp;this&nbsp;file,&nbsp;may&nbsp;be&nbsp;copied,&nbsp;modified,&nbsp;</td></tr>
<tr><td>36</td><td bgcolor="#FFFFFF">%&nbsp;propagated,&nbsp;or&nbsp;distributed&nbsp;except&nbsp;according&nbsp;to&nbsp;the&nbsp;terms&nbsp;contained&nbsp;in&nbsp;the&nbsp;</td></tr>
<tr><td>37</td><td bgcolor="#FFFFFF">%&nbsp;LICENSE&nbsp;file.</td></tr>
<tr><td>38</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>39</td><td bgcolor="#FFFFFF">%&nbsp;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</td></tr>
<tr><td>40</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>41</td><td bgcolor="#FFFFFF">%%&nbsp;define&nbsp;default&nbsp;parameters&nbsp;as&nbsp;a&nbsp;fallback&nbsp;</td></tr>
<tr><td>42</td><td bgcolor="#FF0000">defaultType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'radius';</td></tr>
<tr><td>43</td><td bgcolor="#FF0000">deltaRadDepth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;step&nbsp;size&nbsp;of&nbsp;radiological&nbsp;depth</td></tr>
<tr><td>44</td><td bgcolor="#FF0000">defaultLatCutOff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;25;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;default&nbsp;lateral&nbsp;cut&nbsp;off</td></tr>
<tr><td>45</td><td bgcolor="#FF0000">defaultrelDoseThreshold&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.01;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;default&nbsp;relative&nbsp;dose&nbsp;threshold</td></tr>
<tr><td>46</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>47</td><td bgcolor="#FF0000">relDoseThreshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;defaultrelDoseThreshold;</td></tr>
<tr><td>48</td><td bgcolor="#FF0000">LatCutOff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;defaultLatCutOff;</td></tr>
<tr><td>49</td><td bgcolor="#FF0000">Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sType;</td></tr>
<tr><td>50</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>51</td><td bgcolor="#FFFFFF">%&nbsp;if&nbsp;the&nbsp;input&nbsp;index&nbsp;vector&nbsp;is&nbsp;of&nbsp;type&nbsp;logical&nbsp;convert&nbsp;it&nbsp;to&nbsp;linear&nbsp;indices</td></tr>
<tr><td>52</td><td bgcolor="#FF0000">if&nbsp;islogical(ix)</td></tr>
<tr><td>53</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;ix&nbsp;=&nbsp;find(ix);&nbsp;</td></tr>
<tr><td>54</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>55</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>56</td><td bgcolor="#FFFFFF">%%&nbsp;parse&nbsp;inputs</td></tr>
<tr><td>57</td><td bgcolor="#FF0000">if&nbsp;sum(strcmp(sType,{'radius','dose'}))&nbsp;==&nbsp;0</td></tr>
<tr><td>58</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;Type&nbsp;=&nbsp;defaultType;</td></tr>
<tr><td>59</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>60</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>61</td><td bgcolor="#FFFFFF">%&nbsp;if&nbsp;an&nbsp;parameter&nbsp;is&nbsp;provided&nbsp;then&nbsp;use&nbsp;it</td></tr>
<tr><td>62</td><td bgcolor="#FF0000">if&nbsp;nargin&gt;5&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>63</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;exist('Param','var')</td></tr>
<tr><td>64</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;strcmp(sType,'radius')</td></tr>
<tr><td>65</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LatCutOff&nbsp;=&nbsp;Param;</td></tr>
<tr><td>66</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elseif&nbsp;strcmp(sType,'dose')</td></tr>
<tr><td>67</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relDoseThreshold&nbsp;=&nbsp;Param;</td></tr>
<tr><td>68</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>69</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>70</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>71</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>72</td><td bgcolor="#FFFFFF">%%&nbsp;remember&nbsp;dose&nbsp;values&nbsp;inside&nbsp;the&nbsp;inner&nbsp;core</td></tr>
<tr><td>73</td><td bgcolor="#FF0000">switch&nbsp;&nbsp;Type</td></tr>
<tr><td>74</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;{'radius'}</td></tr>
<tr><td>75</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixCore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;rad_distancesSq&nbsp;&lt;&nbsp;LatCutOff^2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;voxels&nbsp;indices&nbsp;having&nbsp;a&nbsp;smaller&nbsp;radial&nbsp;distance&nbsp;than&nbsp;r0</td></tr>
<tr><td>76</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;{'dose'}</td></tr>
<tr><td>77</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixCore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;bixelDose&nbsp;&gt;&nbsp;relDoseThreshold&nbsp;*&nbsp;max(bixelDose);&nbsp;%&nbsp;get&nbsp;voxels&nbsp;indices&nbsp;having&nbsp;a&nbsp;greater&nbsp;dose&nbsp;than&nbsp;the&nbsp;thresholdDose</td></tr>
<tr><td>78</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>79</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>80</td><td bgcolor="#FF0000">bixelDoseCore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;bixelDose(ixCore);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;save&nbsp;dose&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;affected&nbsp;by&nbsp;sampling</td></tr>
<tr><td>81</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>82</td><td bgcolor="#FF0000">if&nbsp;all(ixCore)</td></tr>
<tr><td>83</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%%&nbsp;all&nbsp;bixels&nbsp;are&nbsp;in&nbsp;the&nbsp;core</td></tr>
<tr><td>84</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%exit&nbsp;function&nbsp;with&nbsp;core&nbsp;dose&nbsp;only</td></tr>
<tr><td>85</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixNew&nbsp;=&nbsp;ix;</td></tr>
<tr><td>86</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;bixelDoseNew&nbsp;=&nbsp;bixelDoseCore;</td></tr>
<tr><td>87</td><td bgcolor="#FFFFFF">else</td></tr>
<tr><td>88</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;logIxTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;~ixCore;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;voxels&nbsp;indices&nbsp;beyond&nbsp;r0</td></tr>
<tr><td>89</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;linIxTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;find(logIxTail);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;convert&nbsp;logical&nbsp;index&nbsp;to&nbsp;linear&nbsp;index</td></tr>
<tr><td>90</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;numTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;numel(linIxTail);</td></tr>
<tr><td>91</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;bixelDoseTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;bixelDose(linIxTail);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;dose&nbsp;values&nbsp;that&nbsp;are&nbsp;going&nbsp;to&nbsp;be&nbsp;reduced&nbsp;by&nbsp;sampling</td></tr>
<tr><td>92</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ix(linIxTail);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;indices&nbsp;that&nbsp;are&nbsp;going&nbsp;to&nbsp;be&nbsp;reduced&nbsp;by&nbsp;sampling</td></tr>
<tr><td>93</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>94</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%%&nbsp;sample&nbsp;for&nbsp;each&nbsp;radiological&nbsp;depth&nbsp;the&nbsp;lateral&nbsp;halo&nbsp;dose</td></tr>
<tr><td>95</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;radDepthTail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(radDepthV(linIxTail));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;radiological&nbsp;depth&nbsp;in&nbsp;the&nbsp;tail</td></tr>
<tr><td>96</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>97</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;cluster&nbsp;radiological&nbsp;dephts&nbsp;to&nbsp;reduce&nbsp;computations</td></tr>
<tr><td>98</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;B_r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;int32(ceil(radDepthTail));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;cluster&nbsp;radiological&nbsp;depths;</td></tr>
<tr><td>99</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;maxRadDepth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;double(max(B_r));</td></tr>
<tr><td>100</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;int32(linspace(0,maxRadDepth,round(maxRadDepth)/deltaRadDepth));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;coarse&nbsp;clustering&nbsp;of&nbsp;rad&nbsp;depths</td></tr>
<tr><td>101</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>102</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixNew&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;zeros(numTail,1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;inizialize&nbsp;new&nbsp;index&nbsp;vector</td></tr>
<tr><td>103</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;bixelDoseNew&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;zeros(numTail,1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;inizialize&nbsp;new&nbsp;dose&nbsp;vector</td></tr>
<tr><td>104</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;linIx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;int32(1:1:numTail)';</td></tr>
<tr><td>105</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;IxCnt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1;</td></tr>
<tr><td>106</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>107</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%%&nbsp;loop&nbsp;over&nbsp;clustered&nbsp;radiological&nbsp;depths</td></tr>
<tr><td>108</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;=&nbsp;1:numel(C)-1</td></tr>
<tr><td>109</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ixTmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;linIx(B_r&nbsp;&gt;=&nbsp;C(i)&nbsp;&amp;&nbsp;B_r&nbsp;&lt;&nbsp;C(i+1));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;extracting&nbsp;sub&nbsp;indices</td></tr>
<tr><td>110</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isempty(ixTmp)</td></tr>
<tr><td>111</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</td></tr>
<tr><td>112</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>113</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subDose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;bixelDoseTail(ixTmp);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;tail&nbsp;dose&nbsp;in&nbsp;current&nbsp;cluster</td></tr>
<tr><td>114</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subIx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ixTail(ixTmp);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;indices&nbsp;in&nbsp;current&nbsp;cluster</td></tr>
<tr><td>115</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thresholdDose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;max(subDose);</td></tr>
<tr><td>116</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;rand(numel(subDose),1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;get&nbsp;random&nbsp;samples</td></tr>
<tr><td>117</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ixSamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&lt;=(subDose/thresholdDose);</td></tr>
<tr><td>118</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NumSamples&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sum(ixSamp);</td></tr>
<tr><td>119</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>120</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ixNew(IxCnt:IxCnt+NumSamples-1,1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;subIx(ixSamp);&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;save&nbsp;new&nbsp;indices</td></tr>
<tr><td>121</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bixelDoseNew(IxCnt:IxCnt+NumSamples-1,1)&nbsp;=&nbsp;thresholdDose;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;set&nbsp;the&nbsp;dose</td></tr>
<tr><td>122</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IxCnt&nbsp;=&nbsp;IxCnt&nbsp;+&nbsp;NumSamples;</td></tr>
<tr><td>123</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>124</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>125</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>126</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;cut&nbsp;new&nbsp;vectors&nbsp;and&nbsp;add&nbsp;inner&nbsp;core&nbsp;values</td></tr>
<tr><td>127</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;ixNew&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[ix(ixCore);&nbsp;&nbsp;&nbsp;&nbsp;ixNew(1:IxCnt-1)];</td></tr>
<tr><td>128</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;bixelDoseNew&nbsp;=&nbsp;[bixelDoseCore;&nbsp;bixelDoseNew(1:IxCnt-1)];</td></tr>
<tr><td>129</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>130</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>131</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>132</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>133</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>134</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>135</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>136</td><td bgcolor="#FFFFFF"></td></tr>
</table></p></body></html>