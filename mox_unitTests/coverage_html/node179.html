<!DOCTYPE html>
<html><head><title>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\tools\matRad_gammaIndex.m</title><STYLE TYPE="text/css"><!--TD{font-family: "Courier New", Courier, monospace; font-size: 10pt;}---></STYLE></head><body><p>(Back to <a href="index.html">index</a>)</p><h1>C:\Users\micha\OneDrive\Dokumente\GitHub\matRad\tools\matRad_gammaIndex.m</h1><p style="font-family:'Courier New'"><table>
<tr><th>Line</th><th>Code</th></tr>
<tr><td>1</td><td bgcolor="#FFFFFF">function&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,slice,n,localglobal,cst)</td></tr>
<tr><td>2</td><td bgcolor="#FFFFFF">%&nbsp;gamma&nbsp;index&nbsp;calculation&nbsp;</td></tr>
<tr><td>3</td><td bgcolor="#FFFFFF">%&nbsp;according&nbsp;to&nbsp;http://www.ncbi.nlm.nih.gov/pubmed/9608475</td></tr>
<tr><td>4</td><td bgcolor="#FFFFFF">%&nbsp;</td></tr>
<tr><td>5</td><td bgcolor="#FFFFFF">%&nbsp;call</td></tr>
<tr><td>6</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,cst)</td></tr>
<tr><td>7</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,slice,cst)</td></tr>
<tr><td>8</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,n,cst)</td></tr>
<tr><td>9</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,localglobal,cst)</td></tr>
<tr><td>10</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,slice,n,cst)</td></tr>
<tr><td>11</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</td></tr>
<tr><td>12</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[gammaCube,gammaPassRateCell]&nbsp;=&nbsp;matRad_gammaIndex(cube1,cube2,resolution,criteria,slice,n,localglobal,cst)</td></tr>
<tr><td>13</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>14</td><td bgcolor="#FFFFFF">%&nbsp;input</td></tr>
<tr><td>15</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;cube1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dose&nbsp;cube&nbsp;as&nbsp;an&nbsp;M&nbsp;x&nbsp;N&nbsp;x&nbsp;O&nbsp;array</td></tr>
<tr><td>16</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;cube2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dose&nbsp;cube&nbsp;as&nbsp;an&nbsp;M&nbsp;x&nbsp;N&nbsp;x&nbsp;O&nbsp;array</td></tr>
<tr><td>17</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;resolution:&nbsp;&nbsp;&nbsp;&nbsp;resolution&nbsp;of&nbsp;the&nbsp;cubes&nbsp;[mm/voxel]</td></tr>
<tr><td>18</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;criteria:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1x2]&nbsp;vector&nbsp;specifying&nbsp;the&nbsp;distance&nbsp;to&nbsp;agreement</td></tr>
<tr><td>19</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;criterion;&nbsp;first&nbsp;element&nbsp;is&nbsp;percentage&nbsp;difference,</td></tr>
<tr><td>20</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;element&nbsp;is&nbsp;distance&nbsp;[mm]</td></tr>
<tr><td>21</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;slice:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(optional)&nbsp;slice&nbsp;in&nbsp;cube1/2&nbsp;that&nbsp;will&nbsp;be&nbsp;visualized&nbsp;</td></tr>
<tr><td>22</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;n:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(optional)&nbsp;number&nbsp;of&nbsp;interpolations.&nbsp;there&nbsp;will&nbsp;be&nbsp;2^n-1&nbsp;</td></tr>
<tr><td>23</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interpolation&nbsp;points.&nbsp;The&nbsp;maximum&nbsp;suggested&nbsp;value&nbsp;is&nbsp;3.</td></tr>
<tr><td>24</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;localglobal:&nbsp;&nbsp;&nbsp;(optional)&nbsp;parameter&nbsp;to&nbsp;choose&nbsp;between&nbsp;'global'&nbsp;and&nbsp;'local'&nbsp;</td></tr>
<tr><td>25</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normalization&nbsp;</td></tr>
<tr><td>26</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;cst:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&nbsp;of&nbsp;interessing&nbsp;volumes&nbsp;inside&nbsp;the&nbsp;patient</td></tr>
<tr><td>27</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>28</td><td bgcolor="#FFFFFF">%&nbsp;output&nbsp;</td></tr>
<tr><td>29</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>30</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;gammaCube:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;of&nbsp;gamma&nbsp;index&nbsp;calculation</td></tr>
<tr><td>31</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;gammaPassRateCell:&nbsp;&nbsp;rate&nbsp;of&nbsp;voxels&nbsp;passing&nbsp;the&nbsp;specified&nbsp;gamma&nbsp;criterion&nbsp;</td></tr>
<tr><td>32</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluated&nbsp;for&nbsp;every&nbsp;structure&nbsp;listed&nbsp;in&nbsp;'cst'.</td></tr>
<tr><td>33</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;note&nbsp;that&nbsp;only&nbsp;voxels&nbsp;exceeding&nbsp;the&nbsp;dose&nbsp;threshold&nbsp;are</td></tr>
<tr><td>34</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;considered.</td></tr>
<tr><td>35</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>36</td><td bgcolor="#FFFFFF">%&nbsp;References</td></tr>
<tr><td>37</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;[1]&nbsp;&nbsp;http://www.ncbi.nlm.nih.gov/pubmed/9608475</td></tr>
<tr><td>38</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>39</td><td bgcolor="#FFFFFF">%&nbsp;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</td></tr>
<tr><td>40</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>41</td><td bgcolor="#FFFFFF">%&nbsp;Copyright&nbsp;2015&nbsp;the&nbsp;matRad&nbsp;development&nbsp;team.&nbsp;</td></tr>
<tr><td>42</td><td bgcolor="#FFFFFF">%&nbsp;</td></tr>
<tr><td>43</td><td bgcolor="#FFFFFF">%&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;matRad&nbsp;project.&nbsp;It&nbsp;is&nbsp;subject&nbsp;to&nbsp;the&nbsp;license&nbsp;</td></tr>
<tr><td>44</td><td bgcolor="#FFFFFF">%&nbsp;terms&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;found&nbsp;in&nbsp;the&nbsp;top-level&nbsp;directory&nbsp;of&nbsp;this&nbsp;</td></tr>
<tr><td>45</td><td bgcolor="#FFFFFF">%&nbsp;distribution&nbsp;and&nbsp;at&nbsp;https://github.com/e0404/matRad/LICENSES.txt.&nbsp;No&nbsp;part&nbsp;</td></tr>
<tr><td>46</td><td bgcolor="#FFFFFF">%&nbsp;of&nbsp;the&nbsp;matRad&nbsp;project,&nbsp;including&nbsp;this&nbsp;file,&nbsp;may&nbsp;be&nbsp;copied,&nbsp;modified,&nbsp;</td></tr>
<tr><td>47</td><td bgcolor="#FFFFFF">%&nbsp;propagated,&nbsp;or&nbsp;distributed&nbsp;except&nbsp;according&nbsp;to&nbsp;the&nbsp;terms&nbsp;contained&nbsp;in&nbsp;the&nbsp;</td></tr>
<tr><td>48</td><td bgcolor="#FFFFFF">%&nbsp;LICENSE&nbsp;file.</td></tr>
<tr><td>49</td><td bgcolor="#FFFFFF">%</td></tr>
<tr><td>50</td><td bgcolor="#FFFFFF">%&nbsp;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</td></tr>
<tr><td>51</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>52</td><td bgcolor="#FF0000">[env,&nbsp;~]&nbsp;=&nbsp;matRad_getEnvironment();</td></tr>
<tr><td>53</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>54</td><td bgcolor="#FFFFFF">%&nbsp;set&nbsp;parameters&nbsp;for&nbsp;gamma&nbsp;index&nbsp;calculation</td></tr>
<tr><td>55</td><td bgcolor="#FF0000">if&nbsp;exist('criteria','var')</td></tr>
<tr><td>56</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;relDoseThreshold&nbsp;=&nbsp;criteria(1);&nbsp;%&nbsp;in&nbsp;[%]</td></tr>
<tr><td>57</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;dist2AgreeMm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;criteria(2);&nbsp;%&nbsp;in&nbsp;[mm]</td></tr>
<tr><td>58</td><td bgcolor="#FFFFFF">else</td></tr>
<tr><td>59</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;dist2AgreeMm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3;&nbsp;%&nbsp;in&nbsp;[mm]</td></tr>
<tr><td>60</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;relDoseThreshold&nbsp;=&nbsp;3;&nbsp;%&nbsp;in&nbsp;[%]</td></tr>
<tr><td>61</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>62</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>63</td><td bgcolor="#FFFFFF">%&nbsp;set&nbsp;parameters&nbsp;for&nbsp;gamma&nbsp;index&nbsp;calculation</td></tr>
<tr><td>64</td><td bgcolor="#FF0000">if&nbsp;~exist('n','var')</td></tr>
<tr><td>65</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;0;</td></tr>
<tr><td>66</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>67</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>68</td><td bgcolor="#FFFFFF">%&nbsp;set&nbsp;global&nbsp;or&nbsp;local&nbsp;gamma&nbsp;evaluation</td></tr>
<tr><td>69</td><td bgcolor="#FF0000">if&nbsp;~exist('localglobal','var')</td></tr>
<tr><td>70</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;localglobal&nbsp;=&nbsp;'global';</td></tr>
<tr><td>71</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>72</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>73</td><td bgcolor="#FFFFFF">%&nbsp;check&nbsp;if&nbsp;cubes&nbsp;consistent</td></tr>
<tr><td>74</td><td bgcolor="#FF0000">if&nbsp;~isequal(size(cube1),size(cube2))</td></tr>
<tr><td>75</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;error('dose&nbsp;cubes&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;size\n');&nbsp;</td></tr>
<tr><td>76</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>77</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>78</td><td bgcolor="#FFFFFF">%&nbsp;define&nbsp;search&nbsp;nighborhood&nbsp;and&nbsp;resolution</td></tr>
<tr><td>79</td><td bgcolor="#FF0000">if&nbsp;round(n)&nbsp;~=&nbsp;n</td></tr>
<tr><td>80</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;error('n&nbsp;must&nbsp;be&nbsp;an&nbsp;integer&nbsp;value');</td></tr>
<tr><td>81</td><td bgcolor="#FFFFFF">else</td></tr>
<tr><td>82</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;resolution&nbsp;=&nbsp;resolution./(2.^n);</td></tr>
<tr><td>83</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>84</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>85</td><td bgcolor="#FF0000">neighborhood&nbsp;=&nbsp;1.5*&nbsp;dist2AgreeMm;&nbsp;%&nbsp;[mm]</td></tr>
<tr><td>86</td><td bgcolor="#FF0000">searchX&nbsp;=&nbsp;ceil(neighborhood./resolution(1));</td></tr>
<tr><td>87</td><td bgcolor="#FF0000">searchY&nbsp;=&nbsp;ceil(neighborhood./resolution(2));</td></tr>
<tr><td>88</td><td bgcolor="#FF0000">searchZ&nbsp;=&nbsp;ceil(neighborhood./resolution(3));</td></tr>
<tr><td>89</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>90</td><td bgcolor="#FFFFFF">%&nbsp;init&nbsp;cube</td></tr>
<tr><td>91</td><td bgcolor="#FFFFFF">%&nbsp;cut&nbsp;all&nbsp;the&nbsp;zeros&nbsp;surrounding&nbsp;the&nbsp;interesting&nbsp;part</td></tr>
<tr><td>92</td><td bgcolor="#FF0000">cut1&nbsp;=&nbsp;any(any(cube1,2),3);</td></tr>
<tr><td>93</td><td bgcolor="#FF0000">cut2&nbsp;=&nbsp;any(any(cube1,1),3);</td></tr>
<tr><td>94</td><td bgcolor="#FF0000">cut3&nbsp;=&nbsp;any(any(cube1,1),2);</td></tr>
<tr><td>95</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>96</td><td bgcolor="#FFFFFF">%&nbsp;avoids&nbsp;that&nbsp;"zero-slides"&nbsp;are&nbsp;deleted&nbsp;between&nbsp;two&nbsp;interest&nbsp;regions</td></tr>
<tr><td>97</td><td bgcolor="#FF0000">k&nbsp;=&nbsp;find(cut1);&nbsp;cut1(k(1):k(end))&nbsp;=&nbsp;1;</td></tr>
<tr><td>98</td><td bgcolor="#FF0000">k&nbsp;=&nbsp;find(cut2);&nbsp;cut2(k(1):k(end))&nbsp;=&nbsp;1;</td></tr>
<tr><td>99</td><td bgcolor="#FF0000">k&nbsp;=&nbsp;find(cut2);&nbsp;cut2(k(1):k(end))&nbsp;=&nbsp;1;</td></tr>
<tr><td>100</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>101</td><td bgcolor="#FFFFFF">%&nbsp;copy&nbsp;cubes</td></tr>
<tr><td>102</td><td bgcolor="#FF0000">cubex1c&nbsp;=&nbsp;cube1;</td></tr>
<tr><td>103</td><td bgcolor="#FF0000">cubex2c&nbsp;=&nbsp;cube2;</td></tr>
<tr><td>104</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>105</td><td bgcolor="#FFFFFF">%&nbsp;cut&nbsp;cubes</td></tr>
<tr><td>106</td><td bgcolor="#FF0000">cubex1c(&nbsp;~cut1,&nbsp;:,&nbsp;:)&nbsp;=&nbsp;[];&nbsp;%&nbsp;rows</td></tr>
<tr><td>107</td><td bgcolor="#FF0000">cubex1c(&nbsp;:,&nbsp;~cut2,&nbsp;:)&nbsp;=&nbsp;[];&nbsp;%&nbsp;columns</td></tr>
<tr><td>108</td><td bgcolor="#FF0000">cubex1c(&nbsp;:,&nbsp;:,&nbsp;~cut3)&nbsp;=&nbsp;[];&nbsp;%&nbsp;slices&nbsp;&nbsp;</td></tr>
<tr><td>109</td><td bgcolor="#FF0000">cubex2c(&nbsp;~cut1,&nbsp;:,&nbsp;:)&nbsp;=&nbsp;[];&nbsp;%&nbsp;rows</td></tr>
<tr><td>110</td><td bgcolor="#FF0000">cubex2c(&nbsp;:,&nbsp;~cut2,&nbsp;:)&nbsp;=&nbsp;[];&nbsp;%&nbsp;columns</td></tr>
<tr><td>111</td><td bgcolor="#FF0000">cubex2c(&nbsp;:,&nbsp;:,&nbsp;~cut3)&nbsp;=&nbsp;[];&nbsp;%&nbsp;slices</td></tr>
<tr><td>112</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>113</td><td bgcolor="#FFFFFF">%&nbsp;pad&nbsp;cubes</td></tr>
<tr><td>114</td><td bgcolor="#FF0000">cubex2&nbsp;=&nbsp;zeros([size(cubex2c,1)+2*searchX&nbsp;size(cubex2c,2)+2*searchY&nbsp;size(cubex2c,3)+2*searchZ]);</td></tr>
<tr><td>115</td><td bgcolor="#FF0000">cubex2((1+searchX):(end-searchX),&nbsp;...</td></tr>
<tr><td>116</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1+searchY):(end-searchY),&nbsp;...</td></tr>
<tr><td>117</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1+searchZ):(end-searchZ))&nbsp;=&nbsp;cubex2c;</td></tr>
<tr><td>118</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>119</td><td bgcolor="#FFFFFF">%&nbsp;interpolate&nbsp;if&nbsp;necessary</td></tr>
<tr><td>120</td><td bgcolor="#FF0000">if&nbsp;n&nbsp;&gt;&nbsp;0</td></tr>
<tr><td>121</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;env</td></tr>
<tr><td>122</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'MATLAB'</td></tr>
<tr><td>123</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cubex2&nbsp;=&nbsp;interp3(cubex2,n,'cubic');</td></tr>
<tr><td>124</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'OCTAVE'</td></tr>
<tr><td>125</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cubex2&nbsp;=&nbsp;interp3(cubex2,n,'linear');</td></tr>
<tr><td>126</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>127</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>128</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>129</td><td bgcolor="#FFFFFF">%&nbsp;set&nbsp;up&nbsp;temporary&nbsp;cubes&nbsp;required&nbsp;for&nbsp;calculation</td></tr>
<tr><td>130</td><td bgcolor="#FF0000">gammaCubeSq&nbsp;=&nbsp;inf*ones(size(cubex1c));</td></tr>
<tr><td>131</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>132</td><td bgcolor="#FFFFFF">%&nbsp;adjust&nbsp;dose&nbsp;threshold</td></tr>
<tr><td>133</td><td bgcolor="#FF0000">if&nbsp;strcmp(localglobal,'local')</td></tr>
<tr><td>134</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;doseThreshold&nbsp;=&nbsp;cubex1c&nbsp;.*&nbsp;relDoseThreshold/100;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>135</td><td bgcolor="#FFFFFF">elseif&nbsp;strcmp(localglobal,'global')</td></tr>
<tr><td>136</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;doseThreshold&nbsp;=&nbsp;relDoseThreshold/100&nbsp;*&nbsp;max(cube1(:));</td></tr>
<tr><td>137</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>138</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>139</td><td bgcolor="#FFFFFF">%&nbsp;search&nbsp;for&nbsp;min</td></tr>
<tr><td>140</td><td bgcolor="#FF0000">for&nbsp;i&nbsp;=&nbsp;-searchX:searchX</td></tr>
<tr><td>141</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;=&nbsp;-searchY:searchY</td></tr>
<tr><td>142</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;k&nbsp;=&nbsp;-searchZ:searchZ</td></tr>
<tr><td>143</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>144</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delta_sq&nbsp;=&nbsp;((i*resolution(1))^2&nbsp;+&nbsp;...</td></tr>
<tr><td>145</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(j*resolution(2))^2&nbsp;+&nbsp;...</td></tr>
<tr><td>146</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(k*resolution(3))^2)&nbsp;/&nbsp;dist2AgreeMm^2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>147</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>148</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpCube&nbsp;=&nbsp;cubex1c&nbsp;-&nbsp;cubex2((1+((2^n)*searchX)+i)&nbsp;:&nbsp;2^n&nbsp;:&nbsp;(end-((2^n)*searchX)+i),&nbsp;...</td></tr>
<tr><td>149</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1+((2^n)*searchY)+j)&nbsp;:&nbsp;2^n&nbsp;:&nbsp;(end-((2^n)*searchY)+j),&nbsp;...</td></tr>
<tr><td>150</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1+((2^n)*searchZ)+k)&nbsp;:&nbsp;2^n&nbsp;:&nbsp;(end-((2^n)*searchZ)+k));</td></tr>
<tr><td>151</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>152</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpCube&nbsp;=&nbsp;tmpCube.^2&nbsp;./&nbsp;doseThreshold.^2&nbsp;+&nbsp;delta_sq;</td></tr>
<tr><td>153</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>154</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gammaCubeSq&nbsp;=&nbsp;min(gammaCubeSq,tmpCube);</td></tr>
<tr><td>155</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>156</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>157</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>158</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>159</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>160</td><td bgcolor="#FFFFFF">%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display&nbsp;'.';</td></tr>
<tr><td>161</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr><td>162</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>163</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>164</td><td bgcolor="#FFFFFF">%&nbsp;evaluate&nbsp;gamma&nbsp;cube&nbsp;and&nbsp;set&nbsp;to&nbsp;zero&nbsp;all&nbsp;the&nbsp;voxel&nbsp;that&nbsp;contain&nbsp;an</td></tr>
<tr><td>165</td><td bgcolor="#FFFFFF">%&nbsp;infinite&nbsp;value</td></tr>
<tr><td>166</td><td bgcolor="#FF0000">gammaCubeSqx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;zeros(size(cube1));</td></tr>
<tr><td>167</td><td bgcolor="#FF0000">gammaCubeSqx(cut1,cut2,cut3)&nbsp;=&nbsp;gammaCubeSq;</td></tr>
<tr><td>168</td><td bgcolor="#FF0000">gammaCube&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sqrt(gammaCubeSqx);</td></tr>
<tr><td>169</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>170</td><td bgcolor="#FFFFFF">%&nbsp;set&nbsp;values&nbsp;where&nbsp;we&nbsp;did&nbsp;not&nbsp;compute&nbsp;gamma&nbsp;keeping&nbsp;inf&nbsp;in&nbsp;the&nbsp;cube&nbsp;to&nbsp;zero</td></tr>
<tr><td>171</td><td bgcolor="#FF0000">gammaCube(cube1&lt;=0&nbsp;&amp;&nbsp;cube2&lt;=0)&nbsp;=&nbsp;0;</td></tr>
<tr><td>172</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;</td></tr>
<tr><td>173</td><td bgcolor="#FFFFFF">%&nbsp;compute&nbsp;gamma&nbsp;pass&nbsp;rate</td></tr>
<tr><td>174</td><td bgcolor="#FF0000">doseIx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;cube1&nbsp;&gt;&nbsp;relDoseThreshold/100*max(cube1(:))&nbsp;|&nbsp;cube2&nbsp;&gt;&nbsp;relDoseThreshold/100*max(cube2(:));</td></tr>
<tr><td>175</td><td bgcolor="#FF0000">numOfPassGamma&nbsp;&nbsp;=&nbsp;sum(gammaCube(doseIx)&nbsp;&lt;&nbsp;1);</td></tr>
<tr><td>176</td><td bgcolor="#FF0000">gammaPassRate&nbsp;&nbsp;&nbsp;=&nbsp;100&nbsp;*&nbsp;numOfPassGamma&nbsp;/&nbsp;sum(doseIx(:));</td></tr>
<tr><td>177</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>178</td><td bgcolor="#FFFFFF">%&nbsp;compute&nbsp;stats&nbsp;for&nbsp;all&nbsp;segmented&nbsp;sturtures</td></tr>
<tr><td>179</td><td bgcolor="#FF0000">if&nbsp;exist('cst','var')</td></tr>
<tr><td>180</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateCell&nbsp;=&nbsp;cell(1,2);</td></tr>
<tr><td>181</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateCell{1,1}&nbsp;=&nbsp;'Whole&nbsp;CT';</td></tr>
<tr><td>182</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateCell{1,2}&nbsp;=&nbsp;gammaPassRate;</td></tr>
<tr><td>183</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>184</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;=&nbsp;1:size(cst,&nbsp;1)</td></tr>
<tr><td>185</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volume&nbsp;=&nbsp;cst{i,4}{1,1};&nbsp;%&nbsp;indices&nbsp;of&nbsp;voxels&nbsp;of&nbsp;the&nbsp;interesting&nbsp;volume</td></tr>
<tr><td>186</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doseIxVol&nbsp;=&nbsp;false(size(doseIx));&nbsp;</td></tr>
<tr><td>187</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doseIxVol(volume)&nbsp;=&nbsp;doseIx(volume);&nbsp;</td></tr>
<tr><td>188</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numOfPassGammaVol&nbsp;&nbsp;=&nbsp;sum(gammaCube(doseIxVol)&nbsp;&lt;&nbsp;1);</td></tr>
<tr><td>189</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateVol&nbsp;&nbsp;&nbsp;=&nbsp;100&nbsp;*&nbsp;numOfPassGammaVol&nbsp;/&nbsp;sum(doseIxVol(:));</td></tr>
<tr><td>190</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isnan(gammaPassRateVol)&nbsp;%&nbsp;remove&nbsp;organs&nbsp;not&nbsp;receiving&nbsp;any&nbsp;dose&nbsp;(resulting&nbsp;in&nbsp;NaN)</td></tr>
<tr><td>191</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</td></tr>
<tr><td>192</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>193</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateCell{end+1,&nbsp;1}&nbsp;=&nbsp;cst{i,2};</td></tr>
<tr><td>194</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gammaPassRateCell{end,&nbsp;2}&nbsp;=&nbsp;gammaPassRateVol;</td></tr>
<tr><td>195</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>196</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;end</td></tr>
<tr><td>197</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>198</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>199</td><td bgcolor="#FFFFFF">%&nbsp;visualize&nbsp;if&nbsp;applicable</td></tr>
<tr><td>200</td><td bgcolor="#FF0000">if&nbsp;exist('slice','var')&nbsp;&amp;&amp;&nbsp;~isempty(slice)</td></tr>
<tr><td>201</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;figure</td></tr>
<tr><td>202</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;set(gcf,'Color',[1&nbsp;1&nbsp;1]);</td></tr>
<tr><td>203</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;imagesc(gammaCube(:,:,slice),[0&nbsp;2])</td></tr>
<tr><td>204</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;myColormap&nbsp;=&nbsp;matRad_getColormap('gammaIndex');</td></tr>
<tr><td>205</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>206</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;colormap(gca,myColormap);</td></tr>
<tr><td>207</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;colorbar</td></tr>
<tr><td>208</td><td bgcolor="#FFFFFF"></td></tr>
<tr><td>209</td><td bgcolor="#FF0000">&nbsp;&nbsp;&nbsp;&nbsp;title({[num2str(gammaPassRate,5)&nbsp;'%&nbsp;of&nbsp;points&nbsp;&gt;&nbsp;'&nbsp;num2str(relDoseThreshold)&nbsp;...</td></tr>
<tr><td>210</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'%&nbsp;pass&nbsp;gamma&nbsp;criterion&nbsp;('&nbsp;num2str(relDoseThreshold)&nbsp;'%&nbsp;/&nbsp;'&nbsp;...</td></tr>
<tr><td>211</td><td bgcolor="#FFFFFF">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num2str(dist2AgreeMm)&nbsp;'mm)'];&nbsp;['with&nbsp;'&nbsp;num2str(2^n-1)&nbsp;'&nbsp;interpolation&nbsp;points']});</td></tr>
<tr><td>212</td><td bgcolor="#FFFFFF">end</td></tr>
<tr><td>213</td><td bgcolor="#FFFFFF"></td></tr>
</table></p></body></html>